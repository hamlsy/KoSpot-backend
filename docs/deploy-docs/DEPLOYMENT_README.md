# KoSpot Backend ë°°í¬ ì‹œìŠ¤í…œ ê°œìš”

## ğŸš€ ë°°í¬ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GitHub Repository                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Source     â”‚  â”‚  Submodule     â”‚  â”‚   Workflows      â”‚   â”‚
â”‚  â”‚    Code      â”‚  â”‚  (Private)     â”‚  â”‚  (.github/)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Push to main
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GitHub Actions                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Build  â”‚â†’ â”‚  Test   â”‚â†’ â”‚  Docker  â”‚â†’ â”‚  Create Zip   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Upload
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS S3 Bucket                             â”‚
â”‚              (deploy-{commit-sha}.zip ì €ì¥)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Deploy
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AWS CodeDeploy                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Stop   â”‚â†’ â”‚  Install â”‚â†’ â”‚  Start   â”‚â†’ â”‚  Validate   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Deploy to
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EC2 Instance                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                       Nginx                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ Port 80/443 â†’ Reverse Proxy                    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Docker Compose Network                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚  Spring Boot    â”‚      â”‚      Redis       â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  (Port 8080)    â”‚â—„â”€â”€â”€â”€â–ºâ”‚   (Port 6379)    â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Connect to
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS RDS MySQL                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ìƒì„±ëœ íŒŒì¼ ëª©ë¡

### 1. Docker ê´€ë ¨
- `Dockerfile` - Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆí™”
- `docker-compose.yml` - Redis + Spring Boot ë©€í‹° ì»¨í…Œì´ë„ˆ êµ¬ì„±

### 2. CI/CD ê´€ë ¨
- `.github/workflows/deploy.yml` - GitHub Actions ì›Œí¬í”Œë¡œìš°
- `appspec.yml` - CodeDeploy ë°°í¬ ì„¤ì •

### 3. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
- `scripts/stop.sh` - ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€
- `scripts/before_install.sh` - ì„¤ì¹˜ ì „ ì¤€ë¹„
- `scripts/after_install.sh` - Docker ì´ë¯¸ì§€ ë¡œë“œ
- `scripts/start.sh` - ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
- `scripts/validate.sh` - ë°°í¬ ê²€ì¦

### 4. Nginx ì„¤ì •
- `nginx/nginx.conf` - Nginx ë©”ì¸ ì„¤ì • (ì°¸ê³ ìš©)
- `nginx/kospot.conf` - KoSpot í”„ë¡œì íŠ¸ ì „ìš© ì„¤ì •

### 5. ë¬¸ì„œ
- `docs/DEPLOYMENT_GUIDE.md` - ì „ì²´ ë°°í¬ ê°€ì´ë“œ
- `docs/EC2_SETUP_GUIDE.md` - EC2 ì„œë²„ ì„¤ì • ìƒì„¸ ê°€ì´ë“œ
- `docs/NGINX_SETUP_GUIDE.md` - Nginx ì„¤ì • ìƒì„¸ ê°€ì´ë“œ
- `docs/ENV_TEMPLATE.md` - í™˜ê²½ë³€ìˆ˜ ì„¤ì • ê°€ì´ë“œ
- `docs/GITHUB_ACTIONS_SETUP.md` - GitHub Actions ì„¤ì • ê°€ì´ë“œ

---

## ğŸ”‘ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

### âš ï¸ ì¤‘ìš”: Submodule ì„¤ì •

í™˜ê²½ë³€ìˆ˜ëŠ” **Private Submodule** (`KoSpot-backend-private`)ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤.

**ìƒì„¸ ê°€ì´ë“œ**: [ENV_MANAGEMENT_GUIDE.md](ENV_MANAGEMENT_GUIDE.md)

### Submoduleì— ì¶”ê°€í•  íŒŒì¼

**`KoSpot-backend-private/.env`** íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:

> **ì™œ .envë¥¼ ìˆ˜ë™ ë°°ì¹˜í•˜ë‚˜ìš”?**  
> ë³´ì•ˆ ë•Œë¬¸ì…ë‹ˆë‹¤. Docker ì´ë¯¸ì§€ë‚˜ S3 ë°°í¬ íŒ¨í‚¤ì§€ì— ë¯¼ê°ì •ë³´ê°€ í¬í•¨ë˜ë©´ ìœ ì¶œ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.  
> EC2ì—ë§Œ .envë¥¼ ë‘ë©´ íŒŒì´í”„ë¼ì¸ ì–´ë””ì—ë„ ë¹„ë°€ë²ˆí˜¸ê°€ ë‚¨ì§€ ì•Šì•„ ì•ˆì „í•©ë‹ˆë‹¤.

```bash
# ============================================
# KoSpot Backend - Production Environment
# ============================================

# -------------------- Database (RDS) --------------------
DB_HOST=your-rds-endpoint.ap-northeast-2.rds.amazonaws.com
DB_PORT=3306
DB_NAME=kospot_prod
DB_USERNAME=admin
DB_PASSWORD=your-strong-db-password-here

# -------------------- Redis --------------------
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=your-strong-redis-password-here

# -------------------- JWT --------------------
JWT_SECRET=your-base64-encoded-256-bit-secret-key-here

# -------------------- OAuth2 --------------------
OAUTH_GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
OAUTH_GOOGLE_CLIENT_SECRET=your-google-client-secret
OAUTH_NAVER_CLIENT_ID=your-naver-client-id
OAUTH_NAVER_CLIENT_SECRET=your-naver-client-secret
OAUTH_KAKAO_CLIENT_ID=your-kakao-client-id
OAUTH_KAKAO_CLIENT_SECRET=your-kakao-client-secret

# -------------------- AWS Configuration --------------------
AWS_ACCESS_KEY=your-aws-access-key-id
AWS_SECRET_KEY=your-aws-secret-access-key
AWS_REGION=ap-northeast-2

# -------------------- AWS S3 Buckets --------------------
# ì´ë¯¸ì§€ ì €ì¥ìš© ë²„í‚· (ë°°ë„ˆ, í¬í† ëª¨ë“œ, ì•„ì´í…œ ë“±)
S3_BUCKET=kospot-images-prod

# -------------------- Application --------------------
SERVER_PORT=8080
SPRING_PROFILES_ACTIVE=prod

# -------------------- CORS --------------------
CORS_FRONT_URL=https://kospot.example.com

# -------------------- WebSocket --------------------
WEBSOCKET_ALLOWED_ORIGINS=https://kospot.example.com

# -------------------- AES Encryption --------------------
AES_SECRET_KEY=your-aes-encryption-key-here
```

**ì´ íŒŒì¼ì„ EC2 ì„œë²„ì˜ `/home/ubuntu/kospot/.env` ê²½ë¡œì— ìˆ˜ë™ìœ¼ë¡œ ë°°ì¹˜í•˜ì„¸ìš”.**

---

## ğŸ“ ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

### AWS ì¸í”„ë¼
- [ ] EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (Ubuntu 22.04, t3.medium ì´ìƒ)
- [ ] RDS MySQL ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
- [ ] S3 Bucket ìƒì„±
  - [ ] `kospot-deploy-bucket` (CodeDeployìš©)
  - [ ] `kospot-images-prod` (ì´ë¯¸ì§€ ì €ì¥ìš©) **[ì‹ ê·œ]**
- [ ] IAM ì—­í•  ìƒì„±
  - [ ] EC2ìš© ì—­í• : S3 ì½ê¸°/ì“°ê¸° ê¶Œí•œ
  - [ ] CodeDeployìš© ì—­í• : AWSCodeDeployRole
  - [ ] GitHub Actionsìš© IAM ì‚¬ìš©ì
- [ ] ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •
  - [ ] EC2: 22(SSH), 80(HTTP), 443(HTTPS)
  - [ ] RDS: 3306 (EC2 ë³´ì•ˆ ê·¸ë£¹ì—ì„œë§Œ)
- [ ] CodeDeploy ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ë°°í¬ ê·¸ë£¹ ìƒì„±

### EC2 ì„œë²„ ì„¤ì •
- [ ] Docker ì„¤ì¹˜
- [ ] Docker Compose ì„¤ì¹˜
- [ ] Nginx ì„¤ì¹˜ ë° ì„¤ì •
- [ ] CodeDeploy Agent ì„¤ì¹˜
- [ ] í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„± (`/home/ubuntu/kospot`)
- [ ] í™˜ê²½ë³€ìˆ˜ íŒŒì¼ ë°°ì¹˜ (`.env`)
- [ ] SSL ì¸ì¦ì„œ ë°œê¸‰ (Let's Encrypt)

### GitHub ì„¤ì •
- [ ] GitHub Secrets ì¶”ê°€
  - [ ] `AWS_ACCESS_KEY_ID`
  - [ ] `AWS_SECRET_ACCESS_KEY`
  - [ ] `SUBMODULE_TOKEN`
- [ ] Workflow íŒŒì¼ í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •
  - [ ] S3 ë²„í‚· ì´ë¦„
  - [ ] CodeDeploy ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„
  - [ ] CodeDeploy ë°°í¬ ê·¸ë£¹ ì´ë¦„

---

## ğŸš€ ë°°í¬ ìˆœì„œ

### 1ë‹¨ê³„: AWS ì¸í”„ë¼ êµ¬ì¶•
```bash
# 1. EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
# 2. RDS ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
# 3. S3 Bucket ìƒì„±
# 4. IAM ì—­í•  ìƒì„±
# 5. CodeDeploy ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±
```

### 2ë‹¨ê³„: EC2 ì„œë²„ ì´ˆê¸° ì„¤ì •
```bash
# SSH ì ‘ì†
ssh -i your-key.pem ubuntu@your-ec2-ip

# ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
sudo apt update && sudo apt upgrade -y

# Docker ì„¤ì¹˜
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker ubuntu

# Docker Compose ì„¤ì¹˜
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Nginx ì„¤ì¹˜
sudo apt install -y nginx

# CodeDeploy Agent ì„¤ì¹˜
wget https://aws-codedeploy-ap-northeast-2.s3.ap-northeast-2.amazonaws.com/latest/install
chmod +x ./install
sudo ./install auto
```

### 3ë‹¨ê³„: Nginx ì„¤ì •
```bash
# Nginx ì„¤ì • íŒŒì¼ ë³µì‚¬
sudo nano /etc/nginx/sites-available/kospot.conf
# (nginx/kospot.conf ë‚´ìš© ë¶™ì—¬ë„£ê¸°)

# ì‹¬ë³¼ë¦­ ë§í¬ ìƒì„±
sudo ln -s /etc/nginx/sites-available/kospot.conf /etc/nginx/sites-enabled/

# ì„¤ì • í…ŒìŠ¤íŠ¸ ë° ì¬ì‹œì‘
sudo nginx -t
sudo systemctl restart nginx
```

### 4ë‹¨ê³„: í™˜ê²½ë³€ìˆ˜ ì„¤ì •
```bash
# í™˜ê²½ë³€ìˆ˜ íŒŒì¼ ìƒì„±
cd /home/ubuntu/kospot
nano .env
# (í™˜ê²½ë³€ìˆ˜ ë‚´ìš© ë¶™ì—¬ë„£ê¸°)

# ê¶Œí•œ ì„¤ì •
chmod 600 .env
```

### 5ë‹¨ê³„: GitHub ì„¤ì •
```bash
# 1. GitHub Secrets ì¶”ê°€ (ì›¹ UI)
# 2. Workflow íŒŒì¼ í™•ì¸ ë° ìˆ˜ì • (í•„ìš” ì‹œ)
```

### 6ë‹¨ê³„: ë°°í¬ ì‹¤í–‰
```bash
# main ë¸Œëœì¹˜ì— í‘¸ì‹œ
git push origin main

# GitHub Actionsì—ì„œ ìë™ ë°°í¬ ì‹œì‘
# AWS CodeDeployì—ì„œ EC2ë¡œ ë°°í¬
```

---

## âœ… ë°°í¬ ê²€ì¦

### 1. EC2ì—ì„œ í™•ì¸
```bash
# ì»¨í…Œì´ë„ˆ ìƒíƒœ
docker-compose ps

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
docker-compose logs -f app

# í—¬ìŠ¤ì²´í¬
curl http://localhost:8080/actuator/health
```

### 2. ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸
```bash
# HTTP ì ‘ì†
http://your-ec2-public-ip/actuator/health

# ë„ë©”ì¸ ì„¤ì • í›„
https://your-domain.com/actuator/health
```

### 3. API í…ŒìŠ¤íŠ¸
```bash
# API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
curl https://your-domain.com/api/v1/test

# WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸
# (WebSocket í´ë¼ì´ì–¸íŠ¸ ë„êµ¬ ì‚¬ìš©)
```

---

## ğŸ”„ ë°°í¬ í”Œë¡œìš°

### ìë™ ë°°í¬ (CI/CD)
```
1. ì½”ë“œ ë³€ê²½ â†’ main ë¸Œëœì¹˜ í‘¸ì‹œ
2. GitHub Actions íŠ¸ë¦¬ê±°
3. ë¹Œë“œ & í…ŒìŠ¤íŠ¸
4. Docker ì´ë¯¸ì§€ ìƒì„±
5. S3ì— ë°°í¬ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ
6. CodeDeploy ë°°í¬ ì‹œì‘
7. EC2ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰:
   - stop.sh: ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€
   - before_install.sh: ë””ë ‰í† ë¦¬ ì¤€ë¹„
   - after_install.sh: Docker ì´ë¯¸ì§€ ë¡œë“œ
   - start.sh: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
   - validate.sh: ë°°í¬ ê²€ì¦
8. ë°°í¬ ì™„ë£Œ
```

### ìˆ˜ë™ ë°°í¬
```bash
# EC2 ì„œë²„ì—ì„œ ì§ì ‘ ë°°í¬
cd /home/ubuntu/kospot
docker-compose down
docker-compose pull  # ìƒˆ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´
docker-compose up -d
```

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë¹ ë¥¸ ì°¸ì¡°

### 502 Bad Gateway
```bash
# ì›ì¸: ë°±ì—”ë“œ ì„œë²„ ë¯¸ì‹¤í–‰
docker-compose ps
docker-compose logs app
docker-compose restart app
```

### CodeDeploy ë°°í¬ ì‹¤íŒ¨
```bash
# CodeDeploy Agent í™•ì¸
sudo systemctl status codedeploy-agent
sudo tail -f /var/log/aws/codedeploy-agent/codedeploy-agent.log
```

### Database ì—°ê²° ì‹¤íŒ¨
```bash
# RDS ë³´ì•ˆ ê·¸ë£¹ í™•ì¸
# .env íŒŒì¼ í™•ì¸
cat /home/ubuntu/kospot/.env
```

### Redis ì—°ê²° ì‹¤íŒ¨
```bash
# Redis ì»¨í…Œì´ë„ˆ í™•ì¸
docker-compose ps redis
docker-compose exec redis redis-cli -a your-password ping
```

---

## ğŸ“š ìƒì„¸ ê°€ì´ë“œ ë¬¸ì„œ

ê° ì£¼ì œë³„ ìƒì„¸ ê°€ì´ë“œ:

1. **[DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md)** - ì „ì²´ ë°°í¬ í”„ë¡œì„¸ìŠ¤
2. **[EC2_SETUP_GUIDE.md](EC2_SETUP_GUIDE.md)** - EC2 ì„œë²„ ì„¤ì • ìƒì„¸
3. **[NGINX_SETUP_GUIDE.md](NGINX_SETUP_GUIDE.md)** - Nginx ì„¤ì • ë° ìµœì í™”
4. **[ENV_TEMPLATE.md](ENV_TEMPLATE.md)** - í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬
5. **[GITHUB_ACTIONS_SETUP.md](GITHUB_ACTIONS_SETUP.md)** - CI/CD ì„¤ì •

---

## ğŸ” ë³´ì•ˆ ê¶Œì¥ì‚¬í•­

### 1. AWS
- [ ] IAM ìµœì†Œ ê¶Œí•œ ì›ì¹™ ì ìš©
- [ ] EC2 ë³´ì•ˆ ê·¸ë£¹: í•„ìš”í•œ í¬íŠ¸ë§Œ ê°œë°©
- [ ] RDS: Public ì ‘ê·¼ ë¹„í™œì„±í™”
- [ ] S3 Bucket: ì•”í˜¸í™” í™œì„±í™”

### 2. EC2 ì„œë²„
- [ ] SSH í‚¤ ê¸°ë°˜ ì¸ì¦ë§Œ í—ˆìš©
- [ ] Root ë¡œê·¸ì¸ ë¹„í™œì„±í™”
- [ ] Fail2Ban ì„¤ì¹˜ (ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²© ë°©ì–´)
- [ ] UFW ë°©í™”ë²½ í™œì„±í™”
- [ ] ìë™ ë³´ì•ˆ ì—…ë°ì´íŠ¸ ì„¤ì •

### 3. ì• í”Œë¦¬ì¼€ì´ì…˜
- [ ] í™˜ê²½ë³€ìˆ˜ íŒŒì¼ ê¶Œí•œ: 600
- [ ] SSL/TLS ì¸ì¦ì„œ ì ìš©
- [ ] CORS ì„¤ì •: í—ˆìš©ëœ ë„ë©”ì¸ë§Œ
- [ ] Rate Limiting ì ìš©

### 4. ëª¨ë‹ˆí„°ë§
- [ ] CloudWatch ë¡œê·¸ ìˆ˜ì§‘
- [ ] ì•ŒëŒ ì„¤ì • (CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬)
- [ ] ì •ê¸°ì ì¸ ë°±ì—… ìˆ˜í–‰

---

## ğŸ’¡ ìœ ìš©í•œ ëª…ë ¹ì–´ ëª¨ìŒ

### Docker
```bash
docker-compose ps                    # ì»¨í…Œì´ë„ˆ ìƒíƒœ
docker-compose logs -f app          # ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
docker-compose restart app          # ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘
docker-compose down && docker-compose up -d  # ì „ì²´ ì¬ì‹œì‘
docker system prune -a              # ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ ì •ë¦¬
```

### Nginx
```bash
sudo nginx -t                       # ì„¤ì • í…ŒìŠ¤íŠ¸
sudo systemctl reload nginx         # ì„¤ì • ë¦¬ë¡œë“œ
sudo systemctl restart nginx        # Nginx ì¬ì‹œì‘
sudo tail -f /var/log/nginx/kospot-access.log  # ì•¡ì„¸ìŠ¤ ë¡œê·¸
```

### CodeDeploy
```bash
sudo systemctl status codedeploy-agent  # Agent ìƒíƒœ
sudo systemctl restart codedeploy-agent # Agent ì¬ì‹œì‘
sudo tail -f /var/log/aws/codedeploy-agent/codedeploy-agent.log  # ë¡œê·¸
```

### ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§
```bash
htop                                # ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤
docker stats                        # ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤
df -h                               # ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
free -h                             # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
```

---

## ğŸ“ ì§€ì›

ë°°í¬ ê´€ë ¨ ë¬¸ì œ ë°œìƒ ì‹œ:
1. í•´ë‹¹ ê°€ì´ë“œ ë¬¸ì„œì˜ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì„¹ì…˜ í™•ì¸
2. GitHub Actions ë¡œê·¸ í™•ì¸
3. EC2 ì¸ìŠ¤í„´ìŠ¤ ë¡œê·¸ í™•ì¸
4. AWS CodeDeploy ì½˜ì†” í™•ì¸

---

**ì‘ì„±ì¼:** 2025-01-27  
**ë²„ì „:** 1.0.0  
**í”„ë¡œì íŠ¸:** KoSpot Backend

